I"œU<h3 id="ç»“è®º">ç»“è®º</h3>

<p>ä¸æ­£ç¡®åœ°ä½¿ç”¨HashMapä¼šå¼•å‘æ­»å¾ªç¯åŠå…ƒç´ ä¸¢å¤±</p>

<h3 id="ç¼˜èµ·">ç¼˜èµ·</h3>

<p>HashMapä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚é‚£ä¹ˆHashMapåœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹åˆä¼šæœ‰ä»€ä¹ˆé—®é¢˜å‘¢ï¼Ÿ</p>

<p>å…ˆç”¨ä¸€æ®µä»£ç ç®€å•æ¨¡æ‹Ÿå‡ºHashMapçš„æ­»å¾ªç¯ï¼š</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">leyou</span><span class="o">.</span><span class="na">test</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.HashMap</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Map</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.concurrent.atomic.AtomicInteger</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TestHashMapResize</span> <span class="kd">extends</span> <span class="nc">Thread</span><span class="o">{</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="nc">AtomicInteger</span> <span class="n">ai</span><span class="o">=</span><span class="k">new</span> <span class="nc">AtomicInteger</span><span class="o">();</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">,</span><span class="nc">Integer</span><span class="o">&gt;</span> <span class="n">map</span><span class="o">=</span><span class="k">new</span> <span class="nc">HashMap</span><span class="o">&lt;&gt;(</span><span class="mi">1</span><span class="o">);</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">(){</span>
        <span class="k">while</span><span class="o">(</span><span class="n">ai</span><span class="o">.</span><span class="na">get</span><span class="o">()&lt;</span><span class="mi">100000</span><span class="o">){</span>
            <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">ai</span><span class="o">.</span><span class="na">get</span><span class="o">(),</span><span class="n">ai</span><span class="o">.</span><span class="na">get</span><span class="o">());</span>
            <span class="n">ai</span><span class="o">.</span><span class="na">incrementAndGet</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">TestHashMapResize</span> <span class="n">hmt0</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">TestHashMapResize</span><span class="o">();</span>
        <span class="nc">TestHashMapResize</span> <span class="n">hmt1</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">TestHashMapResize</span><span class="o">();</span>
        <span class="nc">TestHashMapResize</span> <span class="n">hmt2</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">TestHashMapResize</span><span class="o">();</span>
        <span class="nc">TestHashMapResize</span> <span class="n">hmt3</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">TestHashMapResize</span><span class="o">();</span>
        <span class="nc">TestHashMapResize</span> <span class="n">hmt4</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">TestHashMapResize</span><span class="o">();</span>
        <span class="n">hmt0</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
        <span class="n">hmt1</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
        <span class="n">hmt2</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
        <span class="n">hmt3</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
        <span class="n">hmt4</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
    <span class="o">}</span>

<span class="o">}</span>

</code></pre></div></div>

<p>ä»¥ä¸Šä»£ç ï¼ŒAtomicIntegerå’ŒHashMapéƒ½æ˜¯å…¨å±€å…±äº«çš„ï¼Œçº¿ç¨‹çš„ä½œç”¨å¾ˆç®€å•ï¼Œç»™AtomicIntegerä¸æ–­è‡ªå¢å¹¶å†™å…¥HashMapä¸­ã€‚</p>

<p>å¤šè¿è¡Œå‡ æ¬¡ä¹‹åæ­»å¾ªç¯å°±å‡ºæ¥äº†ï¼Œè¿™é‡Œé¢è¦æä¸€ç‚¹ï¼Œå¤šçº¿ç¨‹ç¯å¢ƒä¸‹ä»£ç ä¼šå‡ºç°é—®é¢˜å¹¶ä¸æ„å‘³ç€å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ä¸€å®šä¼šå‡ºç°é—®é¢˜ï¼Œä½†æ˜¯åªè¦å‡ºç°äº†é—®é¢˜ï¼Œæˆ–è€…æ˜¯æ­»é”ã€æˆ–è€…æ˜¯æ­»å¾ªç¯ï¼Œé‚£ä¹ˆä½ çš„é¡¹ç›®é™¤äº†é‡å¯å°±æ²¡æœ‰ä»€ä¹ˆåˆ«çš„åŠæ³•äº†ï¼Œæ‰€ä»¥ä»£ç çš„çº¿ç¨‹å®‰å…¨æ€§åœ¨å¼€å‘ã€è¯„å®¡çš„æ—¶å€™å¿…é¡»è¦é‡ç‚¹è€ƒè™‘åˆ°ã€‚</p>

<p>çœ‹çœ‹æ§åˆ¶å°ï¼š</p>

<p><img src="http://image.augustrush8.com/images/hashmapresize/resize1.png" alt="" class="center" /></p>

<p>çº¢è‰²æ–¹æ¡†ä¸€ç›´äº®ç€ï¼Œè¯´æ˜ä»£ç æ­»å¾ªç¯äº†ã€‚æ­»å¾ªç¯é—®é¢˜çš„å®šä½ä¸€èˆ¬éƒ½æ˜¯é€šè¿‡<strong>jps+jstack</strong>æŸ¥çœ‹å †æ ˆä¿¡æ¯æ¥å®šä½çš„ï¼š</p>

<p><img src="http://image.augustrush8.com/images/hashmapresize/resize2.png" alt="" class="center" /></p>

<p>çœ‹åˆ°Thread-0å¤„äºRUNNABLEï¼Œè€Œä»å †æ ˆä¿¡æ¯ä¸Šåº”è¯¥å¯ä»¥çœ‹å‡ºï¼Œè¿™æ¬¡çš„æ­»å¾ªç¯æ˜¯ç”±äºThread-0å¯¹HashMapè¿›è¡Œæ‰©å®¹è€Œå¼•èµ·çš„ã€‚</p>

<p>HashMapçš„æ‰©å®¹ä¸ºä»€ä¹ˆä¼šå¼•èµ·æ­»å¾ªç¯ï¼Ÿ</p>

<h3 id="æ­£å¸¸çš„æ‰©å®¹è¿‡ç¨‹">æ­£å¸¸çš„æ‰©å®¹è¿‡ç¨‹</h3>

<p>å…ˆæ¥çœ‹ä¸€ä¸‹HashMapä¸€æ¬¡æ­£å¸¸çš„æ‰©å®¹è¿‡ç¨‹ã€‚ç®€å•ä¸€ç‚¹çœ‹å§ï¼Œå‡è®¾æˆ‘æœ‰ä¸‰ä¸ªç»è¿‡äº†æœ€ç»ˆrehashå¾—åˆ°çš„æ•°å­—ï¼Œåˆ†åˆ«æ˜¯5 7 3ï¼ŒHashMapçš„tableä¹Ÿåªæœ‰2ï¼Œé‚£ä¹ˆHashMapæŠŠè¿™ä¸‰ä¸ªæ•°å­—putè¿›æ•°æ®ç»“æ„äº†ä¹‹ååº”è¯¥æ˜¯è¿™ä¹ˆä¸€ä¸ªæ ·å­çš„ï¼š</p>

<p><img src="http://image.augustrush8.com/images/hashmapresize/resize3.png" alt="" class="center" /></p>

<p>çœ‹ä¸€ä¸‹resizeçš„ä»£ç ï¼š</p>

<p>ä¸‹é¢ä»£ç æ¯”è¾ƒéš¾ä»¥ç†è§£çš„è¯ï¼Œå¯ä»¥å…ˆçœ‹çœ‹è¿™ç¯‡æ–‡ç« ï¼š<a href="https://www.cnblogs.com/zhuoqingsen/p/8577646.html">æ–‡ç« </a></p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">void</span> <span class="nf">addEntry</span><span class="o">(</span><span class="kt">int</span> <span class="n">hash</span><span class="o">,</span> <span class="no">K</span> <span class="n">key</span><span class="o">,</span> <span class="no">V</span> <span class="n">value</span><span class="o">,</span> <span class="kt">int</span> <span class="n">bucketIndex</span><span class="o">)</span> <span class="o">{</span>
<span class="nc">Entry</span><span class="o">&lt;</span><span class="no">K</span><span class="o">,</span><span class="no">V</span><span class="o">&gt;</span> <span class="n">e</span> <span class="o">=</span> <span class="n">table</span><span class="o">[</span><span class="n">bucketIndex</span><span class="o">];</span>
    <span class="n">table</span><span class="o">[</span><span class="n">bucketIndex</span><span class="o">]</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Entry</span><span class="o">&lt;</span><span class="no">K</span><span class="o">,</span><span class="no">V</span><span class="o">&gt;(</span><span class="n">hash</span><span class="o">,</span> <span class="n">key</span><span class="o">,</span> <span class="n">value</span><span class="o">,</span> <span class="n">e</span><span class="o">);</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">size</span><span class="o">++</span> <span class="o">&gt;=</span> <span class="n">threshold</span><span class="o">)</span>
        <span class="n">resize</span><span class="o">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">table</span><span class="o">.</span><span class="na">length</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">void</span> <span class="nf">resize</span><span class="o">(</span><span class="kt">int</span> <span class="n">newCapacity</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">Entry</span><span class="o">[]</span> <span class="n">oldTable</span> <span class="o">=</span> <span class="n">table</span><span class="o">;</span>
    <span class="kt">int</span> <span class="n">oldCapacity</span> <span class="o">=</span> <span class="n">oldTable</span><span class="o">.</span><span class="na">length</span><span class="o">;</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">oldCapacity</span> <span class="o">==</span> <span class="no">MAXIMUM_CAPACITY</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">threshold</span> <span class="o">=</span> <span class="nc">Integer</span><span class="o">.</span><span class="na">MAX_VALUE</span><span class="o">;</span>
        <span class="k">return</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nc">Entry</span><span class="o">[]</span> <span class="n">newTable</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Entry</span><span class="o">[</span><span class="n">newCapacity</span><span class="o">];</span>
    <span class="n">transfer</span><span class="o">(</span><span class="n">newTable</span><span class="o">);</span>
    <span class="n">table</span> <span class="o">=</span> <span class="n">newTable</span><span class="o">;</span>
    <span class="n">threshold</span> <span class="o">=</span> <span class="o">(</span><span class="kt">int</span><span class="o">)(</span><span class="n">newCapacity</span> <span class="o">*</span> <span class="n">loadFactor</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">void</span> <span class="nf">transfer</span><span class="o">(</span><span class="nc">Entry</span><span class="o">[]</span> <span class="n">newTable</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">Entry</span><span class="o">[]</span> <span class="n">src</span> <span class="o">=</span> <span class="n">table</span><span class="o">;</span>
    <span class="kt">int</span> <span class="n">newCapacity</span> <span class="o">=</span> <span class="n">newTable</span><span class="o">.</span><span class="na">length</span><span class="o">;</span>
    <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">src</span><span class="o">.</span><span class="na">length</span><span class="o">;</span> <span class="n">j</span><span class="o">++)</span> <span class="o">{</span>
        <span class="nc">Entry</span><span class="o">&lt;</span><span class="no">K</span><span class="o">,</span><span class="no">V</span><span class="o">&gt;</span> <span class="n">e</span> <span class="o">=</span> <span class="n">src</span><span class="o">[</span><span class="n">j</span><span class="o">];</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">e</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">src</span><span class="o">[</span><span class="n">j</span><span class="o">]</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
            <span class="k">do</span> <span class="o">{</span>
                <span class="nc">Entry</span><span class="o">&lt;</span><span class="no">K</span><span class="o">,</span><span class="no">V</span><span class="o">&gt;</span> <span class="n">next</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="na">next</span><span class="o">;</span>
                <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">indexFor</span><span class="o">(</span><span class="n">e</span><span class="o">.</span><span class="na">hash</span><span class="o">,</span> <span class="n">newCapacity</span><span class="o">);</span>
                <span class="n">e</span><span class="o">.</span><span class="na">next</span> <span class="o">=</span> <span class="n">newTable</span><span class="o">[</span><span class="n">i</span><span class="o">];</span>
                <span class="n">newTable</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">=</span> <span class="n">e</span><span class="o">;</span>
                <span class="n">e</span> <span class="o">=</span> <span class="n">next</span><span class="o">;</span>
            <span class="o">}</span> <span class="k">while</span> <span class="o">(</span><span class="n">e</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>æ€»ç»“ä¸€ä¸‹è¿™ä¸‰æ®µä»£ç ï¼ŒHashMapä¸€æ¬¡æ‰©å®¹çš„è¿‡ç¨‹åº”è¯¥æ˜¯ï¼š</p>

<p>1ã€å–å½“å‰tableçš„2å€ä½œä¸ºæ–°tableçš„å¤§å°</p>

<p>2ã€æ ¹æ®ç®—å‡ºçš„æ–°tableçš„å¤§å°newå‡ºä¸€ä¸ªæ–°çš„Entryæ•°ç»„æ¥ï¼Œåä¸ºnewTable</p>

<p>3ã€è½®è¯¢åŸtableçš„æ¯ä¸€ä¸ªä½ç½®ï¼Œå°†æ¯ä¸ªä½ç½®ä¸Šè¿æ¥çš„Entryï¼Œç®—å‡ºåœ¨æ–°tableä¸Šçš„ä½ç½®ï¼Œå¹¶ä»¥é“¾è¡¨å½¢å¼è¿æ¥</p>

<p>4ã€åŸtableä¸Šçš„æ‰€æœ‰Entryå…¨éƒ¨è½®è¯¢å®Œæ¯•ä¹‹åï¼Œæ„å‘³ç€åŸtableä¸Šé¢çš„æ‰€æœ‰Entryå·²ç»ç§»åˆ°äº†æ–°çš„tableä¸Šï¼ŒHashMapä¸­çš„tableæŒ‡å‘newTable</p>

<p>è¿™æ ·å°±å®Œæˆäº†ä¸€æ¬¡æ‰©å®¹ï¼Œç”¨å›¾è¡¨ç¤ºæ˜¯è¿™æ ·çš„ï¼š</p>

<p><img src="http://image.augustrush8.com/images/hashmapresize/resize4.png" alt="" class="center" /></p>

<p>HashMapçš„ä¸€æ¬¡æ­£å¸¸æ‰©å®¹å°±æ˜¯è¿™æ ·çš„</p>

<h3 id="å¹¶å‘æ‰©å®¹å¯¼è‡´çš„æ­»å¾ªç¯">å¹¶å‘æ‰©å®¹å¯¼è‡´çš„æ­»å¾ªç¯</h3>

<p>ä¾æ—§æ³¨æ„è¿™æ®µtransferä»£ç ï¼š</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">void</span> <span class="nf">transfer</span><span class="o">(</span><span class="nc">Entry</span><span class="o">[]</span> <span class="n">newTable</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">Entry</span><span class="o">[]</span> <span class="n">src</span> <span class="o">=</span> <span class="n">table</span><span class="o">;</span>
    <span class="kt">int</span> <span class="n">newCapacity</span> <span class="o">=</span> <span class="n">newTable</span><span class="o">.</span><span class="na">length</span><span class="o">;</span>
    <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">src</span><span class="o">.</span><span class="na">length</span><span class="o">;</span> <span class="n">j</span><span class="o">++)</span> <span class="o">{</span>
        <span class="nc">Entry</span><span class="o">&lt;</span><span class="no">K</span><span class="o">,</span><span class="no">V</span><span class="o">&gt;</span> <span class="n">e</span> <span class="o">=</span> <span class="n">src</span><span class="o">[</span><span class="n">j</span><span class="o">];</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">e</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">src</span><span class="o">[</span><span class="n">j</span><span class="o">]</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
            <span class="k">do</span> <span class="o">{</span>
                <span class="nc">Entry</span><span class="o">&lt;</span><span class="no">K</span><span class="o">,</span><span class="no">V</span><span class="o">&gt;</span> <span class="n">next</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="na">next</span><span class="o">;</span>
                <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">indexFor</span><span class="o">(</span><span class="n">e</span><span class="o">.</span><span class="na">hash</span><span class="o">,</span> <span class="n">newCapacity</span><span class="o">);</span>
                <span class="n">e</span><span class="o">.</span><span class="na">next</span> <span class="o">=</span> <span class="n">newTable</span><span class="o">[</span><span class="n">i</span><span class="o">];</span>
                <span class="n">newTable</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">=</span> <span class="n">e</span><span class="o">;</span>
                <span class="n">e</span> <span class="o">=</span> <span class="n">next</span><span class="o">;</span>
            <span class="o">}</span> <span class="k">while</span> <span class="o">(</span><span class="n">e</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>ä¸¤ä¸ªçº¿ç¨‹ï¼Œçº¿ç¨‹Aå’Œçº¿ç¨‹Bã€‚å‡è®¾<code class="highlighter-rouge">Entry&lt;K,V&gt; next = e.next;</code>æ‰§è¡Œå®Œæ¯•ï¼Œçº¿ç¨‹Aåˆ‡æ¢ï¼Œé‚£ä¹ˆå¯¹äºçº¿ç¨‹Aè€Œè¨€ï¼Œæ˜¯è¿™æ ·çš„ï¼š</p>

<p><img src="http://image.augustrush8.com/images/hashmapresize/resize5.png" alt="" class="center" /></p>

<p>CPUåˆ‡æ¢åˆ°çº¿ç¨‹Bè¿è¡Œï¼Œçº¿ç¨‹Bå°†æ•´ä¸ªæ‰©å®¹è¿‡ç¨‹å…¨éƒ¨æ‰§è¡Œå®Œæ¯•ï¼Œäºæ˜¯å°±å½¢æˆäº†ï¼š</p>

<p><img src="http://image.augustrush8.com/images/hashmapresize/resize6.png" alt="" class="center" /></p>

<p>æ­¤æ—¶CPUåˆ‡æ¢åˆ°çº¿ç¨‹Aä¸Šï¼Œæ‰§è¡Œdoâ€¦whileâ€¦å¾ªç¯ï¼Œé¦–å…ˆæ”¾ç½®3è¿™ä¸ªEntryï¼š</p>

<p><img src="http://image.augustrush8.com/images/hashmapresize/resize7.png" alt="" class="center" /></p>

<p><strong>ç”±äºçº¿ç¨‹Bå·²ç»æ‰§è¡Œå®Œæ¯•ï¼Œå› æ­¤æ ¹æ®Javaå†…å­˜æ¨¡å‹ï¼ˆJMMï¼‰ï¼Œç°åœ¨tableé‡Œé¢æ‰€æœ‰çš„Entryéƒ½æ˜¯æœ€æ–°çš„ï¼Œä¹Ÿå°±æ˜¯7çš„nextæ˜¯3ï¼Œ3çš„nextæ˜¯null</strong>ã€‚3æ”¾ç½®åˆ°table[3]çš„ä½ç½®ä¸Šäº†ï¼Œä¸‹é¢çš„æ­¥éª¤æ˜¯ï¼š</p>

<p>1ã€e=nextï¼Œå³e=7</p>

<p>2ã€åˆ¤æ–­eä¸ç­‰äºnullï¼Œå¾ªç¯ç»§ç»­</p>

<p>3ã€next=e.nextï¼Œå³next=7çš„nextï¼Œä¹Ÿå°±æ˜¯3</p>

<p>4ã€æ”¾ç½®7è¿™ä¸ªEntry</p>

<p>æ‰€ä»¥ï¼Œç”¨å›¾è¡¨ç¤ºå°±æ˜¯ï¼š</p>

<p><img src="http://image.augustrush8.com/images/hashmapresize/resize8.png" alt="" class="center" /></p>

<p>æ”¾ç½®å®Œ7ä¹‹åï¼Œç»§ç»­è¿è¡Œä»£ç ï¼š</p>

<p>1ã€e=nextï¼Œä¹Ÿå°±æ˜¯è¯´e=3</p>

<p>2ã€åˆ¤æ–­eä¸ç­‰äºnullï¼Œå¾ªç¯ç»§ç»­</p>

<p>3ã€next=e.nextï¼Œå³3çš„nextï¼Œä¹Ÿå°±æ˜¯null</p>

<p>4ã€æ”¾ç½®3è¿™ä¸ªEntry</p>

<p>æŠŠ3ç§»åˆ°table[3]ä¸Šå»ï¼Œæ­»å¾ªç¯å°±å‡ºæ¥äº†ï¼š</p>

<p><img src="http://image.augustrush8.com/images/hashmapresize/resize9.png" alt="" class="center" /></p>

<p>3ç§»åˆ°table[3]ä¸Šå»äº†ï¼Œ3çš„nextæŒ‡å‘7ï¼Œç”±äºåŸå…ˆ7çš„nextæŒ‡å‘3ï¼Œè¿™æ ·å°±æˆäº†ä¸€ä¸ªæ­»å¾ªç¯ã€‚</p>

<p>æ­¤æ—¶æ‰§è¡Œ13è¡Œçš„e=nextï¼Œé‚£ä¹ˆe=nullï¼Œå¾ªç¯ç»ˆæ­¢ã€‚å°½ç®¡æ­¤æ¬¡å¾ªç¯ç¡®å®ç»“æŸäº†ï¼Œä½†æ˜¯åé¢çš„æ“ä½œï¼Œåªè¦æ¶‰åŠè½®è¯¢HashMapæ•°æ®ç»“æ„çš„ï¼Œæ— è®ºæ˜¯è¿­ä»£è¿˜æ˜¯æ‰©å®¹ï¼Œéƒ½å°†åœ¨table[3]è¿™ä¸ªé“¾è¡¨å¤„å‡ºç°æ­»å¾ªç¯ã€‚è¿™ä¹Ÿå°±æ˜¯å‰é¢çš„æ­»å¾ªç¯å †æ ˆå‡ºç°çš„åŸå› ï¼Œtransferçš„484è¡Œï¼Œå› ä¸ºè¿™æ˜¯ä¸€æ¬¡æ‰©å®¹æ“ä½œï¼Œéœ€è¦éå†HashMapæ•°æ®ç»“æ„ï¼Œtransferæ–¹æ³•æ˜¯æ‰©å®¹çš„æœ€åä¸€ä¸ªæ–¹æ³•ã€‚</p>

<h3 id="3-5-7åˆä¼šæœ‰æ€æ ·çš„ç»“æœ">3 5 7åˆä¼šæœ‰æ€æ ·çš„ç»“æœ</h3>

<p>å¯èƒ½æœ‰äººè§‰å¾—ä¸Šé¢çš„æ•°å­—5 7 3å¤ªå·§äº†ï¼Œåƒæ˜¯ä¸“é—¨ä¸ºäº†äº§ç”ŸHashMapçš„æ­»å¾ªç¯è€Œæ•…æ„é€‰æ‹©çš„æ•°å­—ã€‚</p>

<p>æœ‰ä¸€ä¸ªè¢«åå¤å®è·µå¾—å‡ºçš„ç»“è®ºæ˜¯ï¼Œ<strong>ä»»ä½•åœ¨å¤šçº¿ç¨‹ä¸‹å¯èƒ½å‘ç”Ÿçš„é”™è¯¯åœºæ™¯æœ€ç»ˆä¸€å®šä¼šå‘ç”Ÿ</strong>ã€‚</p>

<p>5 7 3è¿™ä¸ªæ•°å­—å¯ä¸å·§ï¼Œæ‰©å®¹å‰ç›¸é‚»ä¸¤ä¸ªEntryè¢«åˆ†é…åˆ°æ‰©å®¹ååŒæ ·çš„tableä½ç½®æ˜¯å¾ˆæ­£å¸¸çš„ã€‚å…³é”®çš„æ˜¯ï¼Œå³ä½¿è¿™ç§å¼‚å¸¸åœºæ™¯å‘ç”Ÿçš„å¯èƒ½æ€§å†ä½ï¼Œåªè¦å‘ç”Ÿä¸€æ¬¡ï¼Œé‚£ä¹ˆä½ çš„ç³»ç»Ÿå°±éƒ¨åˆ†ç”šè‡³å…¨éƒ¨ä¸å¯ç”¨äº†â€”-é™¤äº†é‡å¯ç³»ç»Ÿæ²¡æœ‰ä»»ä½•åŠæ³•ã€‚æ‰€ä»¥ï¼Œè¿™ç§å¯èƒ½ä¼šå‘ç”Ÿçš„å¼‚å¸¸åœºæ™¯å¿…é¡»æå‰æ‰¼æ€ã€‚</p>

<p><img src="http://image.augustrush8.com/images/hashmapresize/resize10.png" alt="" class="center" /></p>

<p>è¿™æ˜¯æ‰©å®¹å‰æ•°æ®ç»“æ„ä¸­çš„å†…å®¹ï¼Œæ‰©å®¹ä¹‹åæ­£å¸¸çš„åº”è¯¥æ˜¯ï¼š</p>

<p><img src="http://image.augustrush8.com/images/hashmapresize/resize11.png" alt="" class="center" /></p>

<p>ç°åœ¨åœ¨å¤šçº¿ç¨‹ä¸‹é‡åˆ°é—®é¢˜äº†ï¼ŒæŸä¸ªçº¿ç¨‹å…ˆæ”¾7ï¼š</p>

<p><img src="http://image.augustrush8.com/images/hashmapresize/resize12.png" alt="" class="center" /></p>

<p>å†æ¥ç€æ”¾5ï¼š</p>

<p><img src="http://image.augustrush8.com/images/hashmapresize/resize13.png" alt="" class="center" /></p>

<p>ç”±äº5çš„nextæ­¤æ—¶ä¸ºnullï¼Œå› æ­¤æ‰©å®¹æ“ä½œç»“æŸï¼Œ3 5 7é€ æˆçš„ç»“æœå°±æ˜¯å…ƒç´ ä¸¢å¤±ã€‚</p>

<h3 id="å¦‚ä½•è§£å†³">å¦‚ä½•è§£å†³</h3>

<p>æŠŠä¸€ä¸ªçº¿ç¨‹éå®‰å…¨çš„é›†åˆä½œä¸ºå…¨å±€å…±äº«çš„ï¼Œæœ¬èº«å°±æ˜¯ä¸€ç§é”™è¯¯çš„åšæ³•ï¼Œå¹¶å‘ä¸‹ä¸€å®šä¼šäº§ç”Ÿé”™è¯¯ã€‚</p>

<p>æ‰€ä»¥ï¼Œè§£å†³è¿™ä¸ªé—®é¢˜çš„åŠæ³•å¾ˆç®€å•ï¼Œæœ‰ä¸¤ç§ï¼š</p>

<p>1ã€ä½¿ç”¨Collections.synchronizedMap(Mao&lt;K,V&gt; m)æ–¹æ³•æŠŠHashMapå˜æˆä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„Map</p>

<p>2ã€ä½¿ç”¨Hashtableã€ConcurrentHashMapè¿™ä¸¤ä¸ªçº¿ç¨‹å®‰å…¨çš„Map</p>

<p>ä¸è¿‡ï¼Œæ—¢ç„¶é€‰æ‹©äº†çº¿ç¨‹å®‰å…¨çš„åŠæ³•ï¼Œé‚£ä¹ˆå¿…ç„¶è¦åœ¨æ€§èƒ½ä¸Šä»˜å‡ºä¸€å®šçš„ä»£ä»·â€”-æ¯•ç«Ÿè¿™ä¸ªä¸–ç•Œä¸Šæ²¡æœ‰åå…¨åç¾çš„äº‹æƒ…ï¼Œæ—¢è¦è¿è¡Œæ•ˆç‡é«˜ã€åˆè¦çº¿ç¨‹å®‰å…¨ã€‚</p>
:ET