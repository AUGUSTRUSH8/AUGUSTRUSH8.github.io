I"Ó-<h2 id="å¼‚å¸¸å¤„ç†">å¼‚å¸¸å¤„ç†</h2>

<p><strong>å¼‚å¸¸å¤„ç†æ‰€é¢ä¸´çš„é—®é¢˜</strong></p>

<ul>
  <li>
    <p>1.æ“ä½œä¸æˆåŠŸä»…å‘ç”¨æˆ·è¿”å›â€œé”™è¯¯ä»£ç ï¼š11111ï¼Œå¤±è´¥ä¿¡æ¯ï¼šæ“ä½œå¤±è´¥â€ï¼Œæ— æ³•åŒºåˆ«å…·ä½“çš„é”™è¯¯ä¿¡æ¯ã€‚</p>
  </li>
  <li>
    <p>2.serviceæ–¹æ³•åœ¨æ‰§è¡Œè¿‡ç¨‹å‡ºç°å¼‚å¸¸åœ¨å“ªæ•è·ï¼Ÿåœ¨serviceä¸­éœ€è¦éƒ½åŠ try/catchï¼Œå¦‚æœåœ¨controllerä¹Ÿéœ€è¦æ·»åŠ 
try/catchï¼Œä»£ç å†—ä½™ä¸¥é‡ä¸”ä¸æ˜“ç»´æŠ¤ã€‚</p>
  </li>
</ul>

<p><strong>è§£å†³æ–¹æ¡ˆ</strong></p>

<ul>
  <li>
    <p>1.åœ¨Serviceæ–¹æ³•ä¸­çš„ç¼–ç é¡ºåºæ˜¯å…ˆæ ¡éªŒåˆ¤æ–­ï¼Œæœ‰é—®é¢˜åˆ™æŠ›å‡ºå…·ä½“çš„å¼‚å¸¸ä¿¡æ¯ï¼Œæœ€åæ‰§è¡Œå…·ä½“çš„ä¸šåŠ¡æ“ä½œï¼Œè¿”å›æˆåŠŸä¿¡æ¯ã€‚</p>
  </li>
  <li>
    <p>2.åœ¨ç»Ÿä¸€å¼‚å¸¸å¤„ç†ç±»ä¸­å»æ•è·å¼‚å¸¸ï¼Œæ— éœ€controlleræ•è·å¼‚å¸¸ï¼Œå‘ç”¨æˆ·è¿”å›ç»Ÿä¸€è§„èŒƒçš„å“åº”ä¿¡æ¯</p>
  </li>
</ul>

<p><strong>ä»£ç æ¨¡æ¿</strong></p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//æ–°å¢é¡µé¢</span>
    <span class="kd">public</span> <span class="nc">CmsPageResult</span> <span class="nf">add</span><span class="o">(</span><span class="nc">CmsPage</span> <span class="n">cmsPage</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span><span class="o">(</span><span class="n">cmsPage</span> <span class="o">==</span> <span class="kc">null</span><span class="o">){</span>
            <span class="c1">//æŠ›å‡ºå¼‚å¸¸ï¼Œéæ³•å‚æ•°å¼‚å¸¸..æŒ‡å®šå¼‚å¸¸ä¿¡æ¯çš„å†…å®¹</span>

        <span class="o">}</span>
        <span class="c1">//æ ¡éªŒé¡µé¢åç§°ã€ç«™ç‚¹Idã€é¡µé¢webpathçš„å”¯ä¸€æ€§</span>
        <span class="c1">//æ ¹æ®é¡µé¢åç§°ã€ç«™ç‚¹Idã€é¡µé¢webpathå»cms_pageé›†åˆï¼Œå¦‚æœæŸ¥åˆ°è¯´æ˜æ­¤é¡µé¢å·²ç»å­˜åœ¨ï¼Œå¦‚æœæŸ¥è¯¢ä¸åˆ°å†ç»§ç»­æ·»åŠ </span>
        <span class="nc">CmsPage</span> <span class="n">cmsPage1</span> <span class="o">=</span> <span class="n">cmsPageRepository</span><span class="o">.</span><span class="na">findByPageNameAndSiteIdAndPageWebPath</span><span class="o">(</span><span class="n">cmsPage</span><span class="o">.</span><span class="na">getPageName</span><span class="o">(),</span> <span class="n">cmsPage</span><span class="o">.</span><span class="na">getSiteId</span><span class="o">(),</span> <span class="n">cmsPage</span><span class="o">.</span><span class="na">getPageWebPath</span><span class="o">());</span>
        <span class="k">if</span><span class="o">(</span><span class="n">cmsPage1</span><span class="o">!=</span><span class="kc">null</span><span class="o">){</span>
            <span class="c1">//é¡µé¢å·²ç»å­˜åœ¨</span>
            <span class="c1">//æŠ›å‡ºå¼‚å¸¸ï¼Œå¼‚å¸¸å†…å®¹å°±æ˜¯é¡µé¢å·²ç»å­˜åœ¨</span>
            <span class="nc">ExceptionCast</span><span class="o">.</span><span class="na">cast</span><span class="o">(</span><span class="nc">CmsCode</span><span class="o">.</span><span class="na">CMS_ADDPAGE_EXISTSNAME</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="c1">//è°ƒç”¨daoæ–°å¢é¡µé¢</span>
        <span class="n">cmsPage</span><span class="o">.</span><span class="na">setPageId</span><span class="o">(</span><span class="kc">null</span><span class="o">);</span>
        <span class="n">cmsPageRepository</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">cmsPage</span><span class="o">);</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">CmsPageResult</span><span class="o">(</span><span class="nc">CommonCode</span><span class="o">.</span><span class="na">SUCCESS</span><span class="o">,</span><span class="n">cmsPage</span><span class="o">);</span>

    <span class="o">}</span>
</code></pre></div></div>

<p><strong>å¼‚å¸¸å¤„ç†æµç¨‹</strong></p>

<ul>
  <li>è‡ªå®šä¹‰å¼‚å¸¸ç±»å‹</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">CustomException</span> <span class="kd">extends</span> <span class="nc">RuntimeException</span> <span class="o">{</span>

    <span class="c1">//é”™è¯¯ä»£ç </span>
    <span class="nc">ResultCode</span> <span class="n">resultCode</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">CustomException</span><span class="o">(</span><span class="nc">ResultCode</span> <span class="n">resultCode</span><span class="o">){</span>
        <span class="k">this</span><span class="o">.</span><span class="na">resultCode</span> <span class="o">=</span> <span class="n">resultCode</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="nc">ResultCode</span> <span class="nf">getResultCode</span><span class="o">(){</span>
        <span class="k">return</span> <span class="n">resultCode</span><span class="o">;</span>
    <span class="o">}</span>


<span class="o">}</span>
</code></pre></div></div>

<ul>
  <li>å¯¹äºå¯é¢„çŸ¥çš„å¼‚å¸¸ç”±ç¨‹åºå‘˜åœ¨ä»£ç ä¸­ä¸»åŠ¨æŠ›å‡º</li>
</ul>

<p>å¦‚ä¸Šç¨‹åºæ¨¡æ¿</p>

<ul>
  <li>å¼‚å¸¸æ•è·</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@ControllerAdvice</span><span class="c1">//æ§åˆ¶å™¨å¢å¼º</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ExceptionCatch</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">Logger</span> <span class="no">LOGGER</span> <span class="o">=</span> <span class="nc">LoggerFactory</span><span class="o">.</span><span class="na">getLogger</span><span class="o">(</span><span class="nc">ExceptionCatch</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

    <span class="c1">//å®šä¹‰mapï¼Œé…ç½®å¼‚å¸¸ç±»å‹æ‰€å¯¹åº”çš„é”™è¯¯ä»£ç </span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="nc">ImmutableMap</span><span class="o">&lt;</span><span class="nc">Class</span><span class="o">&lt;?</span> <span class="kd">extends</span> <span class="nc">Throwable</span><span class="o">&gt;,</span><span class="nc">ResultCode</span><span class="o">&gt;</span> <span class="no">EXCEPTIONS</span><span class="o">;</span>
    <span class="c1">//å®šä¹‰mapçš„builderå¯¹è±¡ï¼Œå»æ„å»ºImmutableMap</span>
    <span class="kd">protected</span> <span class="kd">static</span> <span class="nc">ImmutableMap</span><span class="o">.</span><span class="na">Builder</span><span class="o">&lt;</span><span class="nc">Class</span><span class="o">&lt;?</span> <span class="kd">extends</span> <span class="nc">Throwable</span><span class="o">&gt;,</span><span class="nc">ResultCode</span><span class="o">&gt;</span> <span class="n">builder</span> <span class="o">=</span> <span class="nc">ImmutableMap</span><span class="o">.</span><span class="na">builder</span><span class="o">();</span>

    <span class="c1">//æ•è·CustomExceptionæ­¤ç±»å¼‚å¸¸</span>
    <span class="nd">@ExceptionHandler</span><span class="o">(</span><span class="nc">CustomException</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
    <span class="nd">@ResponseBody</span>
    <span class="kd">public</span> <span class="nc">ResponseResult</span> <span class="nf">customException</span><span class="o">(</span><span class="nc">CustomException</span> <span class="n">customException</span><span class="o">){</span>
        <span class="c1">//è®°å½•æ—¥å¿—</span>
        <span class="no">LOGGER</span><span class="o">.</span><span class="na">error</span><span class="o">(</span><span class="s">"catch exception:{}"</span><span class="o">,</span><span class="n">customException</span><span class="o">.</span><span class="na">getMessage</span><span class="o">());</span>
        <span class="nc">ResultCode</span> <span class="n">resultCode</span> <span class="o">=</span> <span class="n">customException</span><span class="o">.</span><span class="na">getResultCode</span><span class="o">();</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">ResponseResult</span><span class="o">(</span><span class="n">resultCode</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="c1">//æ•è·Exceptionæ­¤ç±»å¼‚å¸¸</span>
    <span class="nd">@ExceptionHandler</span><span class="o">(</span><span class="nc">Exception</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
    <span class="nd">@ResponseBody</span>
    <span class="kd">public</span> <span class="nc">ResponseResult</span> <span class="nf">exception</span><span class="o">(</span><span class="nc">Exception</span> <span class="n">exception</span><span class="o">){</span>
        <span class="c1">//è®°å½•æ—¥å¿—</span>
        <span class="no">LOGGER</span><span class="o">.</span><span class="na">error</span><span class="o">(</span><span class="s">"catch exception:{}"</span><span class="o">,</span><span class="n">exception</span><span class="o">.</span><span class="na">getMessage</span><span class="o">());</span>
        <span class="k">if</span><span class="o">(</span><span class="no">EXCEPTIONS</span> <span class="o">==</span> <span class="kc">null</span><span class="o">){</span>
            <span class="no">EXCEPTIONS</span> <span class="o">=</span> <span class="n">builder</span><span class="o">.</span><span class="na">build</span><span class="o">();</span><span class="c1">//EXCEPTIONSæ„å»ºæˆåŠŸ</span>
        <span class="o">}</span>
        <span class="c1">//ä»EXCEPTIONSä¸­æ‰¾å¼‚å¸¸ç±»å‹æ‰€å¯¹åº”çš„é”™è¯¯ä»£ç ï¼Œå¦‚æœæ‰¾åˆ°äº†å°†é”™è¯¯ä»£ç å“åº”ç»™ç”¨æˆ·ï¼Œå¦‚æœæ‰¾ä¸åˆ°ç»™ç”¨æˆ·å“åº”99999å¼‚å¸¸</span>
        <span class="nc">ResultCode</span> <span class="n">resultCode</span> <span class="o">=</span> <span class="no">EXCEPTIONS</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">exception</span><span class="o">.</span><span class="na">getClass</span><span class="o">());</span>
        <span class="k">if</span><span class="o">(</span><span class="n">resultCode</span> <span class="o">!=</span><span class="kc">null</span><span class="o">){</span>
            <span class="k">return</span> <span class="k">new</span> <span class="nf">ResponseResult</span><span class="o">(</span><span class="n">resultCode</span><span class="o">);</span>
        <span class="o">}</span><span class="k">else</span><span class="o">{</span>
            <span class="c1">//è¿”å›99999å¼‚å¸¸</span>
            <span class="k">return</span> <span class="k">new</span> <span class="nf">ResponseResult</span><span class="o">(</span><span class="nc">CommonCode</span><span class="o">.</span><span class="na">SERVER_ERROR</span><span class="o">);</span>
        <span class="o">}</span>


    <span class="o">}</span>

    <span class="kd">static</span> <span class="o">{</span>
        <span class="c1">//å®šä¹‰å¼‚å¸¸ç±»å‹æ‰€å¯¹åº”çš„é”™è¯¯ä»£ç </span>
        <span class="n">builder</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="nc">HttpMessageNotReadableException</span><span class="o">.</span><span class="na">class</span><span class="o">,</span><span class="nc">CommonCode</span><span class="o">.</span><span class="na">INVALID_PARAM</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<ul>
  <li>ç»Ÿä¸€å¼‚å¸¸å¤„ç†å›¾ç¤º</li>
</ul>

<p><img src="http://image.augustrush8.com/images/ç»Ÿä¸€å¼‚å¸¸å¤„ç†.jpg" alt="ç»Ÿä¸€å¼‚å¸¸å¤„ç†" class="center" /></p>
:ET