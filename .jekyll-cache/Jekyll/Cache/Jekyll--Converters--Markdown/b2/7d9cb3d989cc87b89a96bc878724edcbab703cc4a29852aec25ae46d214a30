I"ñg<blockquote>
  <p>åŸæ–‡å‡ºå¤„ï¼š<a href="https://my.oschina.net/liughDevelop/blog/1457097">åŸæ–‡</a></p>
</blockquote>

<blockquote>
  <p>ä¸ºä»€ä¹ˆä¼šæœ‰é¢å‘åˆ‡é¢ç¼–ç¨‹ï¼ˆAOPï¼‰ï¼Ÿæˆ‘ä»¬çŸ¥é“Javaæ˜¯ä¸€ä¸ªé¢å‘å¯¹è±¡ï¼ˆOOPï¼‰çš„è¯­è¨€ï¼Œä½†å®ƒæœ‰ä¸€äº›å¼Šç«¯ï¼Œæ¯”å¦‚å½“æˆ‘ä»¬éœ€è¦ä¸ºå¤šä¸ªä¸å…·æœ‰ç»§æ‰¿å…³ç³»çš„å¯¹è±¡å¼•å…¥ä¸€ä¸ªå…¬å…±è¡Œä¸ºï¼Œä¾‹å¦‚æ—¥å¿—ã€æƒé™éªŒè¯ã€äº‹åŠ¡ç­‰åŠŸèƒ½æ—¶ï¼Œåªèƒ½åœ¨åœ¨æ¯ä¸ªå¯¹è±¡é‡Œå¼•ç”¨å…¬å…±è¡Œä¸ºã€‚è¿™æ ·åšä¸ä¾¿äºç»´æŠ¤ï¼Œè€Œä¸”æœ‰å¤§é‡é‡å¤ä»£ç ã€‚AOPçš„å‡ºç°å¼¥è¡¥äº†OOPçš„è¿™ç‚¹ä¸è¶³ã€‚</p>
</blockquote>

<p>ä¸ºäº†é˜è¿°æ¸…æ¥šSpring AOPï¼Œæˆ‘ä»¬å°†ä»ä»¥ä¸‹æ–¹é¢è¿›è¡Œè®¨è®ºï¼š</p>

<ul>
  <li>ä»£ç†æ¨¡å¼</li>
  <li>é™æ€ä»£ç†åŸç†åŠå®è·µ</li>
  <li>åŠ¨æ€ä»£ç†åŸç†åŠå®è·µ</li>
  <li>Spring AOPåŸç†åŠå®æˆ˜</li>
</ul>

<h3 id="ä»£ç†æ¨¡å¼">ä»£ç†æ¨¡å¼</h3>

<p><strong>ä»£ç†æ¨¡å¼</strong>ï¼šä¸ºå…¶ä»–å¯¹è±¡æä¾›ä¸€ç§ä»£ç†ä»¥æ§åˆ¶å¯¹è¿™ä¸ªå¯¹è±¡çš„è®¿é—®ã€‚è¿™æ®µè¯æ¯”è¾ƒå®˜æ–¹ï¼Œä½†æˆ‘æ›´å€¾å‘äºç”¨è‡ªå·±çš„è¯­è¨€ç†è§£ï¼šæ¯”å¦‚Aå¯¹è±¡è¦åšä¸€ä»¶äº‹æƒ…ï¼Œåœ¨æ²¡æœ‰ä»£ç†å‰ï¼Œè‡ªå·±æ¥åšï¼›åœ¨å¯¹ A ä»£ç†åï¼Œç”± A çš„ä»£ç†ç±» B æ¥åšã€‚ä»£ç†å…¶å®æ˜¯åœ¨åŸå®ä¾‹å‰ååŠ äº†ä¸€å±‚å¤„ç†ï¼Œè¿™ä¹Ÿæ˜¯ AOP çš„åˆçº§è½®å»“ã€‚</p>

<h3 id="é™æ€ä»£ç†åŸç†åŠå®è·µ">é™æ€ä»£ç†åŸç†åŠå®è·µ</h3>

<p><strong>é™æ€ä»£ç†æ¨¡å¼</strong>ï¼šé™æ€ä»£ç†è¯´ç™½äº†ï¼Œå°±æ˜¯åœ¨<strong>ç¨‹åºè¿è¡Œå‰å°±å·²ç»å­˜åœ¨ä»£ç†ç±»çš„å­—èŠ‚ç æ–‡ä»¶</strong>ã€ä»£ç†ç±»å’ŒåŸå§‹ç±»çš„å…³ç³»åœ¨è¿è¡Œå‰å°±å·²ç»ç¡®å®šã€‚åºŸè¯ä¸å¤šè¯´ï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸‹ä»£ç ã€‚</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="n">test</span><span class="o">.</span><span class="na">staticProxy</span><span class="o">;</span>
 
<span class="c1">// æ¥å£</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">IUserDao</span> <span class="o">{</span>
    <span class="kt">void</span> <span class="nf">save</span><span class="o">();</span>
    <span class="kt">void</span> <span class="nf">find</span><span class="o">();</span>
<span class="o">}</span>
 
<span class="c1">//ç›®æ ‡å¯¹è±¡</span>
<span class="kd">class</span> <span class="nc">UserDao</span> <span class="kd">implements</span> <span class="nc">IUserDao</span><span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">save</span><span class="o">()</span> <span class="o">{</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"æ¨¡æ‹Ÿï¼šä¿å­˜ç”¨æˆ·ï¼"</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">find</span><span class="o">()</span> <span class="o">{</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"æ¨¡æ‹Ÿï¼šæŸ¥è¯¢ç”¨æˆ·"</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
 
<span class="cm">/**
  * é™æ€ä»£ç†
  * ç‰¹ç‚¹ï¼š
  * 1. ç›®æ ‡å¯¹è±¡å¿…é¡»è¦å®ç°æ¥å£
  * 2. ä»£ç†å¯¹è±¡ï¼Œè¦å®ç°ä¸ç›®æ ‡å¯¹è±¡ä¸€æ ·çš„æ¥å£
 */</span>
<span class="kd">class</span> <span class="nc">UserDaoProxy</span> <span class="kd">implements</span> <span class="nc">IUserDao</span><span class="o">{</span>
 
    <span class="c1">// ä»£ç†å¯¹è±¡ï¼Œéœ€è¦ç»´æŠ¤ä¸€ä¸ªç›®æ ‡å¯¹è±¡</span>
    <span class="kd">private</span> <span class="nc">IUserDao</span> <span class="n">target</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">UserDao</span><span class="o">();</span>
 
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">save</span><span class="o">()</span> <span class="o">{</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"ä»£ç†æ“ä½œï¼š å¼€å¯äº‹åŠ¡..."</span><span class="o">);</span>
        <span class="n">target</span><span class="o">.</span><span class="na">save</span><span class="o">();</span>   <span class="c1">// æ‰§è¡Œç›®æ ‡å¯¹è±¡çš„æ–¹æ³•</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"ä»£ç†æ“ä½œï¼šæäº¤äº‹åŠ¡..."</span><span class="o">);</span>
    <span class="o">}</span>
 
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">find</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">target</span><span class="o">.</span><span class="na">find</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>æ³¨æ„çœ‹ä¸Šé¢çš„ç‰¹ç‚¹ï¼š</p>

<blockquote>
  <p>ç›®æ ‡å¯¹è±¡å¿…é¡»è¦å®ç°æ¥å£</p>

  <p>ä»£ç†å¯¹è±¡ï¼Œè¦å®ç°ä¸ç›®æ ‡å¯¹è±¡ä¸€æ ·çš„æ¥å£</p>
</blockquote>

<p>é™æ€ä»£ç†è™½ç„¶ä¿è¯äº†ä¸šåŠ¡ç±»åªéœ€å…³æ³¨é€»è¾‘æœ¬èº«ï¼Œä»£ç†å¯¹è±¡çš„ä¸€ä¸ªæ¥å£åªæœåŠ¡äºä¸€ç§ç±»å‹çš„å¯¹è±¡ã€‚å¦‚æœè¦ä»£ç†çš„æ–¹æ³•å¾ˆå¤šï¼ŒåŠ¿å¿…è¦ä¸ºæ¯ä¸€ç§æ–¹æ³•éƒ½è¿›è¡Œä»£ç†ã€‚å†è€…ï¼Œå¦‚æœå¢åŠ ä¸€ä¸ªæ–¹æ³•ï¼Œé™¤äº†å®ç°ç±»éœ€è¦å®ç°è¿™ä¸ªæ–¹æ³•å¤–ï¼Œæ‰€æœ‰çš„ä»£ç†ç±»ä¹Ÿè¦å®ç°æ­¤æ–¹æ³•ã€‚å¢åŠ äº†ä»£ç çš„ç»´æŠ¤æˆæœ¬ã€‚é‚£ä¹ˆè¦å¦‚ä½•è§£å†³å‘¢ï¼Ÿç­”æ¡ˆæ˜¯ä½¿ç”¨åŠ¨æ€ä»£ç†ã€‚</p>

<h3 id="åŠ¨æ€ä»£ç†åŸç†åŠå®è·µ">åŠ¨æ€ä»£ç†åŸç†åŠå®è·µ</h3>

<p>åŠ¨æ€ä»£ç†æ¨¡å¼ï¼šåŠ¨æ€ä»£ç†ç±»çš„æºç æ˜¯åœ¨ç¨‹åºè¿è¡ŒæœŸé—´ï¼Œé€šè¿‡ JVM åå°„ç­‰æœºåˆ¶åŠ¨æ€ç”Ÿæˆã€‚<strong>ä»£ç†ç±»å’Œå§”æ‰˜ç±»çš„å…³ç³»æ˜¯è¿è¡Œæ—¶æ‰ç¡®å®šçš„</strong>ã€‚å®ä¾‹å¦‚ä¸‹ï¼š</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="n">test</span><span class="o">.</span><span class="na">dynamicProxy</span><span class="o">;</span>
 
<span class="kn">import</span> <span class="nn">java.lang.reflect.InvocationHandler</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.lang.reflect.Method</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.lang.reflect.Proxy</span><span class="o">;</span>
 
<span class="c1">// æ¥å£</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">IUserDao</span> <span class="o">{</span>
    <span class="kt">void</span> <span class="nf">save</span><span class="o">();</span>
    <span class="kt">void</span> <span class="nf">find</span><span class="o">();</span>
<span class="o">}</span>
 
<span class="c1">//ç›®æ ‡å¯¹è±¡</span>
<span class="kd">class</span> <span class="nc">UserDao</span> <span class="kd">implements</span> <span class="nc">IUserDao</span><span class="o">{</span>
 
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">save</span><span class="o">()</span> <span class="o">{</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"æ¨¡æ‹Ÿï¼š ä¿å­˜ç”¨æˆ·ï¼"</span><span class="o">);</span>
    <span class="o">}</span>
 
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">find</span><span class="o">()</span> <span class="o">{</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"æŸ¥è¯¢"</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
 
<span class="cm">/**
 * åŠ¨æ€ä»£ç†ï¼š
 * ä»£ç†å·¥å‚ï¼Œç»™å¤šä¸ªç›®æ ‡å¯¹è±¡ç”Ÿæˆä»£ç†å¯¹è±¡ï¼
 *
 */</span>
<span class="kd">class</span> <span class="nc">ProxyFactory</span> <span class="o">{</span>
 
    <span class="c1">// æ¥æ”¶ä¸€ä¸ªç›®æ ‡å¯¹è±¡</span>
    <span class="kd">private</span> <span class="nc">Object</span> <span class="n">target</span><span class="o">;</span>
 
    <span class="kd">public</span> <span class="nf">ProxyFactory</span><span class="o">(</span><span class="nc">Object</span> <span class="n">target</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">target</span> <span class="o">=</span> <span class="n">target</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="c1">// è¿”å›å¯¹ç›®æ ‡å¯¹è±¡(target)ä»£ç†åçš„å¯¹è±¡(proxy)</span>
    <span class="kd">public</span> <span class="nc">Object</span> <span class="nf">getProxyInstance</span><span class="o">()</span> <span class="o">{</span>
        <span class="nc">Object</span> <span class="n">proxy</span> <span class="o">=</span> <span class="nc">Proxy</span><span class="o">.</span><span class="na">newProxyInstance</span><span class="o">(</span>
            <span class="n">target</span><span class="o">.</span><span class="na">getClass</span><span class="o">().</span><span class="na">getClassLoader</span><span class="o">(),</span>  <span class="c1">// ç›®æ ‡å¯¹è±¡ä½¿ç”¨çš„ç±»åŠ è½½å™¨</span>
            <span class="n">target</span><span class="o">.</span><span class="na">getClass</span><span class="o">().</span><span class="na">getInterfaces</span><span class="o">(),</span>   <span class="c1">// ç›®æ ‡å¯¹è±¡å®ç°çš„æ‰€æœ‰æ¥å£</span>
            <span class="k">new</span> <span class="nf">InvocationHandler</span><span class="o">()</span> <span class="o">{</span>            <span class="c1">// æ‰§è¡Œä»£ç†å¯¹è±¡æ–¹æ³•æ—¶å€™è§¦å‘</span>
 
                <span class="nd">@Override</span>
                <span class="kd">public</span> <span class="nc">Object</span> <span class="nf">invoke</span><span class="o">(</span><span class="nc">Object</span> <span class="n">proxy</span><span class="o">,</span> <span class="nc">Method</span> <span class="n">method</span><span class="o">,</span> <span class="nc">Object</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span>
                        <span class="kd">throws</span> <span class="nc">Throwable</span> <span class="o">{</span>
 
                    <span class="c1">// è·å–å½“å‰æ‰§è¡Œçš„æ–¹æ³•çš„æ–¹æ³•å</span>
                    <span class="nc">String</span> <span class="n">methodName</span> <span class="o">=</span> <span class="n">method</span><span class="o">.</span><span class="na">getName</span><span class="o">();</span>
                    <span class="c1">// æ–¹æ³•è¿”å›å€¼</span>
                    <span class="nc">Object</span> <span class="n">result</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
                    <span class="k">if</span> <span class="o">(</span><span class="s">"find"</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">methodName</span><span class="o">))</span> <span class="o">{</span>
                        <span class="c1">// ç›´æ¥è°ƒç”¨ç›®æ ‡å¯¹è±¡æ–¹æ³•</span>
                        <span class="n">result</span> <span class="o">=</span> <span class="n">method</span><span class="o">.</span><span class="na">invoke</span><span class="o">(</span><span class="n">target</span><span class="o">,</span> <span class="n">args</span><span class="o">);</span>
                    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"å¼€å¯äº‹åŠ¡..."</span><span class="o">);</span>
                        <span class="c1">// æ‰§è¡Œç›®æ ‡å¯¹è±¡æ–¹æ³•</span>
                        <span class="n">result</span> <span class="o">=</span> <span class="n">method</span><span class="o">.</span><span class="na">invoke</span><span class="o">(</span><span class="n">target</span><span class="o">,</span> <span class="n">args</span><span class="o">);</span>
                        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"æäº¤äº‹åŠ¡..."</span><span class="o">);</span>
                    <span class="o">}</span>
                    <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
                <span class="o">}</span>
            <span class="o">}</span>
        <span class="o">);</span>
        <span class="k">return</span> <span class="n">proxy</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>æµ‹è¯•å’Œç»“æœï¼š</p>

<p><img src="http://image.augustrush8.com/images/springAOP1.png" alt="" /></p>

<p>æ³¨æ„ä¸‹é¢è¿™æ®µä»£ç ï¼š</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">IUserDao</span> <span class="n">proxy</span> <span class="o">=</span> <span class="o">(</span><span class="nc">IUserDao</span><span class="o">)</span><span class="k">new</span> <span class="nc">ProxyFactory</span><span class="o">(</span><span class="n">target</span><span class="o">).</span><span class="na">getProxyInstance</span><span class="o">();</span>
</code></pre></div></div>

<p>å…¶å®æ˜¯ JDK åŠ¨æ€ç”Ÿæˆäº†ä¸€ä¸ªç±»å»å®ç°æ¥å£ï¼Œéšè—äº†è¿™ä¸ªè¿‡ç¨‹ï¼š</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="err">$</span><span class="nc">jdkProxy</span> <span class="kd">implements</span> <span class="nc">IUserDao</span><span class="o">{}</span>
</code></pre></div></div>

<p><strong>ä½¿ç”¨ JDK ç”Ÿæˆçš„åŠ¨æ€ä»£ç†çš„å‰ææ˜¯ç›®æ ‡ç±»å¿…é¡»æœ‰å®ç°çš„æ¥å£</strong>ã€‚ä½†è¿™é‡Œåˆå¼•å…¥ä¸€ä¸ªé—®é¢˜ï¼Œå¦‚æœæŸä¸ªç±»æ²¡æœ‰å®ç°æ¥å£ï¼Œå°±ä¸èƒ½ä½¿ç”¨ JDK åŠ¨æ€ä»£ç†ã€‚æ‰€ä»¥ CGLIB ä»£ç†å°±æ˜¯è§£å†³è¿™ä¸ªé—®é¢˜çš„ã€‚</p>

<p>CGLIB æ˜¯ä»¥åŠ¨æ€ç”Ÿæˆçš„å­ç±»ç»§æ‰¿ç›®æ ‡çš„æ–¹å¼å®ç°ï¼Œåœ¨è¿è¡ŒæœŸåŠ¨æ€çš„åœ¨å†…å­˜ä¸­æ„å»ºä¸€ä¸ªå­ç±»ï¼Œå¦‚ä¸‹ï¼š</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">UserDao</span><span class="o">{}</span>
 
<span class="c1">// CGLIB æ˜¯ä»¥åŠ¨æ€ç”Ÿæˆçš„å­ç±»ç»§æ‰¿ç›®æ ‡çš„æ–¹å¼å®ç°,ç¨‹åºæ‰§è¡Œæ—¶,éšè—äº†ä¸‹é¢çš„è¿‡ç¨‹</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="err">$</span><span class="nc">Cglib_Proxy_class</span>  <span class="kd">extends</span> <span class="nc">UserDao</span><span class="o">{}</span>
</code></pre></div></div>

<p><strong>CGLIB ä½¿ç”¨çš„å‰ææ˜¯ç›®æ ‡ç±»ä¸èƒ½ä¸º final ä¿®é¥°</strong>ã€‚å› ä¸º final ä¿®é¥°çš„ç±»ä¸èƒ½è¢«ç»§æ‰¿ã€‚</p>

<p>ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹çœ‹ AOP çš„å®šä¹‰ï¼šé¢å‘åˆ‡é¢ç¼–ç¨‹ï¼Œæ ¸å¿ƒåŸç†æ˜¯<strong>ä½¿ç”¨åŠ¨æ€ä»£ç†æ¨¡å¼åœ¨æ–¹æ³•æ‰§è¡Œå‰åæˆ–å‡ºç°å¼‚å¸¸æ—¶åŠ å…¥ç›¸å…³é€»è¾‘</strong>ã€‚</p>

<p>é€šè¿‡å®šä¹‰å’Œå‰é¢ä»£ç æˆ‘ä»¬å¯ä»¥å‘ç°3ç‚¹ï¼š</p>

<ul>
  <li>AOP æ˜¯åŸºäºåŠ¨æ€ä»£ç†æ¨¡å¼ã€‚</li>
  <li>AOP æ˜¯æ–¹æ³•çº§åˆ«çš„ã€‚</li>
  <li>AOP å¯ä»¥åˆ†ç¦»ä¸šåŠ¡ä»£ç å’Œå…³æ³¨ç‚¹ä»£ç ï¼ˆé‡å¤ä»£ç ï¼‰ï¼Œåœ¨æ‰§è¡Œä¸šåŠ¡ä»£ç æ—¶ï¼ŒåŠ¨æ€çš„æ³¨å…¥å…³æ³¨ç‚¹ä»£ç ã€‚åˆ‡é¢å°±æ˜¯å…³æ³¨ç‚¹ä»£ç å½¢æˆçš„ç±»ã€‚</li>
</ul>

<h3 id="spring-aop">Spring AOP</h3>

<p>å‰æ–‡æåˆ° JDK ä»£ç†å’Œ CGLIB ä»£ç†ä¸¤ç§åŠ¨æ€ä»£ç†ã€‚ä¼˜ç§€çš„ Spring æ¡†æ¶æŠŠä¸¤ç§æ–¹å¼åœ¨åº•å±‚éƒ½é›†æˆäº†è¿›å»ï¼Œæˆ‘ä»¬æ— éœ€æ‹…å¿ƒè‡ªå·±å»å®ç°åŠ¨æ€ç”Ÿæˆä»£ç†ã€‚é‚£ä¹ˆï¼ŒSpringæ˜¯å¦‚ä½•ç”Ÿæˆä»£ç†å¯¹è±¡çš„ï¼Ÿ</p>

<ol>
  <li>åˆ›å»ºå®¹å™¨å¯¹è±¡çš„æ—¶å€™ï¼Œæ ¹æ®åˆ‡å…¥ç‚¹è¡¨è¾¾å¼æ‹¦æˆªçš„ç±»ï¼Œç”Ÿæˆä»£ç†å¯¹è±¡ã€‚</li>
  <li>å¦‚æœç›®æ ‡å¯¹è±¡æœ‰å®ç°æ¥å£ï¼Œä½¿ç”¨ JDK ä»£ç†ã€‚å¦‚æœç›®æ ‡å¯¹è±¡æ²¡æœ‰å®ç°æ¥å£ï¼Œåˆ™ä½¿ç”¨ CGLIB ä»£ç†ã€‚ç„¶åä»å®¹å™¨è·å–ä»£ç†åçš„å¯¹è±¡ï¼Œåœ¨è¿è¡ŒæœŸæ¤å…¥â€œåˆ‡é¢â€ç±»çš„æ–¹æ³•ã€‚å…¶å®ä»springæºç ä¹Ÿå¯ä»¥å¾—åˆ°å°è¯</li>
</ol>

<p><img src="http://image.augustrush8.com/images/springAOP2.png" alt="img" /></p>

<p><strong>ç»“è®º</strong>ï¼šSpring AOP ç»¼åˆä¸¤ç§ä»£ç†æ–¹å¼çš„ä½¿ç”¨å‰ææœ‰ä¼šå¦‚ä¸‹ç»“è®ºï¼šå¦‚æœç›®æ ‡ç±»æ²¡æœ‰å®ç°æ¥å£ï¼Œä¸” class ä¸º final ä¿®é¥°çš„ï¼Œåˆ™ä¸èƒ½è¿›è¡Œ Spring AOP ç¼–ç¨‹ï¼</p>

<h3 id="å®è·µaop">å®è·µAOP</h3>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="n">test</span><span class="o">.</span><span class="na">spring_aop_anno</span><span class="o">;</span>
 
<span class="kn">import</span> <span class="nn">org.aspectj.lang.ProceedingJoinPoint</span><span class="o">;</span>
 
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">IUserDao</span> <span class="o">{</span>
    <span class="kt">void</span> <span class="nf">save</span><span class="o">();</span>
<span class="o">}</span>
 
<span class="c1">// ç”¨äºæµ‹è¯• CGLIB åŠ¨æ€ä»£ç†</span>
<span class="kd">class</span> <span class="nc">OrderDao</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">save</span><span class="o">()</span> <span class="o">{</span>
        <span class="c1">//int i =1/0; ç”¨äºæµ‹è¯•å¼‚å¸¸é€šçŸ¥</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"ä¿å­˜è®¢å•..."</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
 
<span class="c1">//ç”¨äºæµ‹è¯• JDK åŠ¨æ€ä»£ç†</span>
<span class="kd">class</span> <span class="nc">UserDao</span> <span class="kd">implements</span> <span class="nc">IUserDao</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">save</span><span class="o">()</span> <span class="o">{</span>
        <span class="c1">//int i =1/0; ç”¨äºæµ‹è¯•å¼‚å¸¸é€šçŸ¥</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"ä¿å­˜ç”¨æˆ·..."</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
 
<span class="c1">//åˆ‡é¢ç±»</span>
<span class="kd">class</span> <span class="nc">TransactionAop</span> <span class="o">{</span>
 
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">beginTransaction</span><span class="o">()</span> <span class="o">{</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"[å‰ç½®é€šçŸ¥]  å¼€å¯äº‹åŠ¡.."</span><span class="o">);</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">commit</span><span class="o">()</span> <span class="o">{</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"[åç½®é€šçŸ¥] æäº¤äº‹åŠ¡.."</span><span class="o">);</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">afterReturing</span><span class="o">()</span> <span class="o">{</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"[è¿”å›åé€šçŸ¥]"</span><span class="o">);</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">afterThrowing</span><span class="o">()</span> <span class="o">{</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"[å¼‚å¸¸é€šçŸ¥]"</span><span class="o">);</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">arroud</span><span class="o">(</span><span class="nc">ProceedingJoinPoint</span> <span class="n">pjp</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Throwable</span> <span class="o">{</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"[ç¯ç»•å‰ï¼š]"</span><span class="o">);</span>
        <span class="n">pjp</span><span class="o">.</span><span class="na">proceed</span><span class="o">();</span> <span class="c1">// æ‰§è¡Œç›®æ ‡æ–¹æ³•</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"[ç¯ç»•åï¼š]"</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Spring çš„ XML é…ç½®æ–‡ä»¶ï¼š</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="nt">&lt;beans</span> <span class="na">xmlns=</span><span class="s">"http://www.springframework.org/schema/beans"</span>
    <span class="na">xmlns:xsi=</span><span class="s">"http://www.w3.org/2001/XMLSchema-instance"</span>
    <span class="na">xmlns:context=</span><span class="s">"http://www.springframework.org/schema/context"</span>
    <span class="na">xmlns:aop=</span><span class="s">"http://www.springframework.org/schema/aop"</span>
    <span class="na">xsi:schemaLocation=</span><span class="s">"
 
http://www.springframework.org/schema/beans
 
 
http://www.springframework.org/schema/beans/spring-beans.xsd
 
 
http://www.springframework.org/schema/context
 
 
http://www.springframework.org/schema/context/spring-context.xsd
 
 
http://www.springframework.org/schema/aop
 
 
http://www.springframework.org/schema/aop/spring-aop.xsd"</span><span class="nt">&gt;</span>
 
    <span class="c">&lt;!-- daoå®ä¾‹åŠ å…¥å®¹å™¨ --&gt;</span>
    <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"userDao"</span> <span class="na">class=</span><span class="s">"test.spring_aop_anno.UserDao"</span><span class="nt">&gt;&lt;/bean&gt;</span>
 
    <span class="c">&lt;!-- daoå®ä¾‹åŠ å…¥å®¹å™¨ --&gt;</span>
    <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"orderDao"</span> <span class="na">class=</span><span class="s">"test.spring_aop_anno.OrderDao"</span><span class="nt">&gt;&lt;/bean&gt;</span>
 
    <span class="c">&lt;!-- å®ä¾‹åŒ–åˆ‡é¢ç±» --&gt;</span>
    <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"transactionAop"</span> <span class="na">class=</span><span class="s">"test.spring_aop_anno.TransactionAop"</span><span class="nt">&gt;&lt;/bean&gt;</span>
 
    <span class="c">&lt;!-- Aopç›¸å…³é…ç½® --&gt;</span>
    <span class="nt">&lt;aop:config&gt;</span>
        <span class="c">&lt;!-- åˆ‡å…¥ç‚¹è¡¨è¾¾å¼å®šä¹‰ --&gt;</span>
        <span class="nt">&lt;aop:pointcut</span> <span class="na">expression=</span><span class="s">"execution(* test.spring_aop_anno.*Dao.*(..))"</span> <span class="na">id=</span><span class="s">"transactionPointcut"</span><span class="nt">/&gt;</span>
        <span class="c">&lt;!-- åˆ‡é¢é…ç½® --&gt;</span>
        <span class="nt">&lt;aop:aspect</span> <span class="na">ref=</span><span class="s">"transactionAop"</span><span class="nt">&gt;</span>
            <span class="c">&lt;!-- ã€ç¯ç»•é€šçŸ¥ã€‘ --&gt;</span>
            <span class="nt">&lt;aop:around</span> <span class="na">method=</span><span class="s">"arroud"</span> <span class="na">pointcut-ref=</span><span class="s">"transactionPointcut"</span><span class="nt">/&gt;</span>
            <span class="c">&lt;!-- ã€å‰ç½®é€šçŸ¥ã€‘ åœ¨ç›®æ ‡æ–¹æ³•ä¹‹å‰æ‰§è¡Œ --&gt;</span>
            <span class="nt">&lt;aop:before</span> <span class="na">method=</span><span class="s">"beginTransaction"</span> <span class="na">pointcut-ref=</span><span class="s">"transactionPointcut"</span> <span class="nt">/&gt;</span>
            <span class="c">&lt;!-- ã€åç½®é€šçŸ¥ã€‘ --&gt;</span>
            <span class="nt">&lt;aop:after</span> <span class="na">method=</span><span class="s">"commit"</span> <span class="na">pointcut-ref=</span><span class="s">"transactionPointcut"</span><span class="nt">/&gt;</span>
            <span class="c">&lt;!-- ã€è¿”å›åé€šçŸ¥ã€‘ --&gt;</span>
            <span class="nt">&lt;aop:after-returning</span> <span class="na">method=</span><span class="s">"afterReturing"</span> <span class="na">pointcut-ref=</span><span class="s">"transactionPointcut"</span><span class="nt">/&gt;</span>
            <span class="c">&lt;!-- å¼‚å¸¸é€šçŸ¥ --&gt;</span>
            <span class="nt">&lt;aop:after-throwing</span> <span class="na">method=</span><span class="s">"afterThrowing"</span> <span class="na">pointcut-ref=</span><span class="s">"transactionPointcut"</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/aop:aspect&gt;</span>
    <span class="nt">&lt;/aop:config&gt;</span>
<span class="nt">&lt;/beans&gt;</span>
</code></pre></div></div>

<p>æµ‹è¯•ä»£ç ï¼š</p>

<p><img src="http://image.augustrush8.com/images/springAOP3.png" alt="img" /></p>

<p>åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬å·²ç»å…¨éƒ¨ä»‹ç»å®ŒSpring AOPã€‚å›åˆ°å¼€ç¯‡çš„é—®é¢˜ï¼Œæˆ‘ä»¬æ‹¿å®ƒåšä»€ä¹ˆï¼Ÿ</p>

<ul>
  <li>Springå£°æ˜å¼äº‹åŠ¡ç®¡ç†é…ç½®</li>
  <li>Controllerå±‚çš„å‚æ•°æ ¡éªŒ</li>
  <li>ä½¿ç”¨ Spring AOP å®ç° MySQL æ•°æ®åº“è¯»å†™åˆ†ç¦»æ¡ˆä¾‹åˆ†æ</li>
  <li>åœ¨æ‰§è¡Œæ–¹æ³•å‰ï¼Œåˆ¤æ–­æ˜¯å¦å…·æœ‰æƒé™</li>
  <li>å¯¹éƒ¨åˆ†å‡½æ•°çš„è°ƒç”¨è¿›è¡Œæ—¥å¿—è®°å½•ï¼šç›‘æ§éƒ¨åˆ†é‡è¦å‡½æ•°ï¼Œè‹¥æŠ›å‡ºæŒ‡å®šçš„å¼‚å¸¸ï¼Œå¯ä»¥ä»¥çŸ­ä¿¡æˆ–é‚®ä»¶æ–¹å¼é€šçŸ¥ç›¸å…³äººå‘˜ã€‚</li>
  <li>ä¿¡æ¯è¿‡æ»¤ï¼Œé¡µé¢è½¬å‘ç­‰ç­‰åŠŸèƒ½</li>
</ul>
:ET